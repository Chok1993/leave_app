import streamlit as st
import pandas as pd
import datetime as dt

# ===== à¹„à¸Ÿà¸¥à¹Œà¹€à¸à¹‡à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥ =====
FILE_SCAN = "scan_report.xlsx"
FILE_REPORT = "leave_report.xlsx"

# à¹‚à¸«à¸¥à¸”à¹„à¸Ÿà¸¥à¹Œ à¸–à¹‰à¸²à¹„à¸¡à¹ˆà¸¡à¸µà¹ƒà¸«à¹‰à¸ªà¸£à¹‰à¸²à¸‡ DataFrame à¸§à¹ˆà¸²à¸‡
try:
    df_scan = pd.read_excel(FILE_SCAN)
except:
    df_scan = pd.DataFrame()

try:
    df_report = pd.read_excel(FILE_REPORT)
except:
    df_report = pd.DataFrame()

# ===== à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­à¸à¸¥à¸¸à¹ˆà¸¡à¸‡à¸²à¸™ =====
staff_groups = [
    "à¸à¸¥à¸¸à¹ˆà¸¡à¹‚à¸£à¸„à¸•à¸´à¸”à¸•à¹ˆà¸­",
    "à¸à¸¥à¸¸à¹ˆà¸¡à¸£à¸°à¸šà¸²à¸”à¸§à¸´à¸—à¸¢à¸²à¹à¸¥à¸°à¸•à¸­à¸šà¹‚à¸•à¹‰à¸ à¸²à¸§à¸°à¸‰à¸¸à¸à¹€à¸‰à¸´à¸™à¸—à¸²à¸‡à¸ªà¸²à¸˜à¸²à¸£à¸“à¸ªà¸¸à¸‚",
    "à¸à¸¥à¸¸à¹ˆà¸¡à¸žà¸±à¸’à¸™à¸²à¸­à¸‡à¸„à¹Œà¸à¸£",
    "à¸¨à¸¹à¸™à¸¢à¹Œà¸„à¸§à¸šà¸„à¸¸à¸¡à¹‚à¸£à¸„à¸•à¸´à¸”à¸•à¹ˆà¸­à¸™à¸³à¹‚à¸”à¸¢à¹à¸¡à¸¥à¸‡à¸—à¸µà¹ˆ 9.1 à¸ˆ.à¸Šà¸±à¸¢à¸ à¸¹à¸¡à¸´",
    "à¸¨à¸¹à¸™à¸¢à¹Œà¸„à¸§à¸šà¸„à¸¸à¸¡à¹‚à¸£à¸„à¸•à¸´à¸”à¸•à¹ˆà¸­à¸™à¸³à¹‚à¸”à¸¢à¹à¸¡à¸¥à¸‡à¸—à¸µà¹ˆ 9.2 à¸ˆ.à¸šà¸¸à¸£à¸µà¸£à¸±à¸¡à¸¢à¹Œ",
    "à¸¨à¸¹à¸™à¸¢à¹Œà¸„à¸§à¸šà¸„à¸¸à¸¡à¹‚à¸£à¸„à¸•à¸´à¸”à¸•à¹ˆà¸­à¸™à¸³à¹‚à¸”à¸¢à¹à¸¡à¸¥à¸‡à¸—à¸µà¹ˆ 9.3 à¸ˆ.à¸ªà¸¸à¸£à¸´à¸™à¸—à¸£à¹Œ",
    "à¸¨à¸¹à¸™à¸¢à¹Œà¸„à¸§à¸šà¸„à¸¸à¸¡à¹‚à¸£à¸„à¸•à¸´à¸”à¸•à¹ˆà¸­à¸™à¸³à¹‚à¸”à¸¢à¹à¸¡à¸¥à¸‡à¸—à¸µà¹ˆ 9.4 à¸›à¸²à¸à¸Šà¹ˆà¸­à¸‡",
    "à¸”à¹ˆà¸²à¸™à¸„à¸§à¸šà¸„à¸¸à¸¡à¹‚à¸£à¸„à¸•à¸´à¸”à¸•à¹ˆà¸­à¸£à¸°à¸«à¸§à¹ˆà¸²à¸‡à¸›à¸£à¸°à¹€à¸—à¸¨à¸žà¸£à¸¡à¹à¸”à¸™à¸Šà¹ˆà¸­à¸‡à¸ˆà¸­à¸¡ à¸ˆ.à¸ªà¸¸à¸£à¸´à¸™à¸—à¸£à¹Œ",
    "à¸à¸¥à¸¸à¹ˆà¸¡à¹‚à¸£à¸„à¹„à¸¡à¹ˆà¸•à¸´à¸”à¸•à¹ˆà¸­",
    "à¸‡à¸²à¸™à¸„à¸§à¸šà¸„à¸¸à¸¡à¹‚à¸£à¸„à¹€à¸‚à¸•à¹€à¸¡à¸·à¸­à¸‡",
    "à¸‡à¸²à¸™à¸à¸Žà¸«à¸¡à¸²à¸¢",
    "à¸à¸¥à¸¸à¹ˆà¸¡à¹‚à¸£à¸„à¸•à¸´à¸”à¸•à¹ˆà¸­à¹€à¸£à¸·à¹‰à¸­à¸£à¸±à¸‡",
    "à¸à¸¥à¸¸à¹ˆà¸¡à¸«à¹‰à¸­à¸‡à¸›à¸à¸´à¸šà¸±à¸•à¸´à¸à¸²à¸£à¸—à¸²à¸‡à¸à¸²à¸£à¹à¸žà¸—à¸¢à¹Œà¸”à¹‰à¸²à¸™à¸„à¸§à¸šà¸„à¸¸à¸¡à¹‚à¸£à¸„",
    "à¸à¸¥à¸¸à¹ˆà¸¡à¸ªà¸·à¹ˆà¸­à¸ªà¸²à¸£à¸„à¸§à¸²à¸¡à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¹‚à¸£à¸„à¹à¸¥à¸°à¸ à¸±à¸¢à¸ªà¸¸à¸‚à¸ à¸²à¸ž",
    "à¸à¸¥à¸¸à¹ˆà¸¡à¹‚à¸£à¸„à¸ˆà¸²à¸à¸à¸²à¸£à¸›à¸£à¸°à¸à¸­à¸šà¸­à¸²à¸Šà¸µà¸žà¹à¸¥à¸°à¸ªà¸´à¹ˆà¸‡à¹à¸§à¸”à¸¥à¹‰à¸­à¸¡",
    "à¸¨à¸¹à¸™à¸¢à¹Œà¸šà¸£à¸´à¸à¸²à¸£à¹€à¸§à¸Šà¸¨à¸²à¸ªà¸•à¸£à¹Œà¸›à¹‰à¸­à¸‡à¸à¸±à¸™",
    "à¸à¸¥à¸¸à¹ˆà¸¡à¸šà¸£à¸´à¸«à¸²à¸£à¸—à¸±à¹ˆà¸§à¹„à¸›",
    "à¸¨à¸¹à¸™à¸¢à¹Œà¸à¸¶à¸à¸­à¸šà¸£à¸¡à¸™à¸±à¸à¸£à¸°à¸šà¸²à¸”à¸§à¸´à¸—à¸¢à¸²à¸ à¸²à¸„à¸ªà¸™à¸²à¸¡",
    "à¸à¸¥à¸¸à¹ˆà¸¡à¸žà¸±à¸’à¸™à¸²à¸™à¸§à¸±à¸•à¸à¸£à¸£à¸¡à¹à¸¥à¸°à¸§à¸´à¸ˆà¸±à¸¢"
]

# ===== à¹€à¸¡à¸™à¸¹à¸«à¸¥à¸±à¸ =====
st.title("ðŸ“‹ à¹‚à¸›à¸£à¹à¸à¸£à¸¡à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ (à¸ªà¸„à¸£.9)")
menu = st.radio("à¹€à¸¥à¸·à¸­à¸à¸›à¸£à¸°à¹€à¸ à¸—à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¸šà¸±à¸™à¸—à¸¶à¸", ["à¸à¸²à¸£à¹„à¸›à¸£à¸²à¸Šà¸à¸²à¸£", "à¸à¸²à¸£à¸¥à¸²"])

# ===== à¸Ÿà¸­à¸£à¹Œà¸¡à¸šà¸±à¸™à¸—à¸¶à¸à¸à¸²à¸£à¹„à¸›à¸£à¸²à¸Šà¸à¸²à¸£ =====
if menu == "à¸à¸²à¸£à¹„à¸›à¸£à¸²à¸Šà¸à¸²à¸£":
    with st.form("scan_form"):
        data = {}
        data["à¸Šà¸·à¹ˆà¸­-à¸ªà¸à¸¸à¸¥"] = st.text_input("ðŸ‘¤ à¸Šà¸·à¹ˆà¸­-à¸ªà¸à¸¸à¸¥")
        data["à¸à¸¥à¸¸à¹ˆà¸¡à¸‡à¸²à¸™"] = st.selectbox("ðŸ¢ à¸à¸¥à¸¸à¹ˆà¸¡à¸‡à¸²à¸™", staff_groups)
        data["à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸£à¸´à¹ˆà¸¡"] = st.date_input("ðŸ“… à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™", dt.date.today())
        data["à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”"] = st.date_input("ðŸ“… à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”", dt.date.today())
        data["à¸ˆà¸³à¸™à¸§à¸™à¸§à¸±à¸™"] = (data["à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”"] - data["à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸£à¸´à¹ˆà¸¡"]).days + 1

        # âœ… à¹€à¸›à¸¥à¸µà¹ˆà¸¢à¸™à¹ƒà¸«à¹‰à¸œà¸¹à¹‰à¹ƒà¸Šà¹‰à¸žà¸´à¸¡à¸žà¹Œà¸Šà¸·à¹ˆà¸­à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¹€à¸­à¸‡
        data["à¸à¸´à¸ˆà¸à¸£à¸£à¸¡"] = st.text_input("ðŸ¢ à¸Šà¸·à¹ˆà¸­à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸—à¸µà¹ˆà¹„à¸›", placeholder="à¹€à¸Šà¹ˆà¸™ à¸­à¸šà¸£à¸¡à¸«à¸¥à¸±à¸à¸ªà¸¹à¸•à¸£à¸à¸²à¸£à¸žà¸±à¸’à¸™à¸²à¸¨à¸±à¸à¸¢à¸ à¸²à¸žà¸šà¸¸à¸„à¸¥à¸²à¸à¸£")

        data["à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆ"] = st.text_input("ðŸ“ à¸ªà¸–à¸²à¸™à¸—à¸µà¹ˆ")
        data["à¸œà¸¹à¹‰à¸ˆà¸±à¸”"] = st.text_input("ðŸ‘¥ à¸œà¸¹à¹‰à¸ˆà¸±à¸”")
        data["à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸"] = st.text_input("ðŸ“ à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸")

        # ===== à¸œà¸¹à¹‰à¸£à¹ˆà¸§à¸¡à¹€à¸”à¸´à¸™à¸—à¸²à¸‡ =====
        st.markdown("### ðŸ‘¨â€ðŸ‘©â€ðŸ‘§â€ðŸ‘¦ à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­à¸œà¸¹à¹‰à¸£à¹ˆà¸§à¸¡à¹€à¸”à¸´à¸™à¸—à¸²à¸‡ (à¸«à¸²à¸à¹„à¸›à¹€à¸›à¹‡à¸™à¸«à¸¡à¸¹à¹ˆà¸„à¸“à¸°)")
        num_people = st.number_input("à¸ˆà¸³à¸™à¸§à¸™à¸œà¸¹à¹‰à¸£à¹ˆà¸§à¸¡à¹€à¸”à¸´à¸™à¸—à¸²à¸‡", min_value=0, max_value=20, step=1)
        companions = []

        for i in range(int(num_people)):
            name = st.text_input(f"à¸Šà¸·à¹ˆà¸­-à¸ªà¸à¸¸à¸¥à¸œà¸¹à¹‰à¸£à¹ˆà¸§à¸¡à¹€à¸”à¸´à¸™à¸—à¸²à¸‡à¸„à¸™à¸—à¸µà¹ˆ {i+1}", key=f"name_{i}")
            group = st.selectbox(f"à¸à¸¥à¸¸à¹ˆà¸¡à¸‡à¸²à¸™à¸‚à¸­à¸‡à¸œà¸¹à¹‰à¸£à¹ˆà¸§à¸¡à¹€à¸”à¸´à¸™à¸—à¸²à¸‡à¸„à¸™à¸—à¸µà¹ˆ {i+1}", staff_groups, key=f"group_{i}")
            if name:
                companions.append({"à¸Šà¸·à¹ˆà¸­-à¸ªà¸à¸¸à¸¥": name, "à¸à¸¥à¸¸à¹ˆà¸¡à¸‡à¸²à¸™": group})

        data["à¸œà¸¹à¹‰à¸£à¹ˆà¸§à¸¡à¹€à¸”à¸´à¸™à¸—à¸²à¸‡"] = ", ".join([p["à¸Šà¸·à¹ˆà¸­-à¸ªà¸à¸¸à¸¥"] for p in companions])

        submitted = st.form_submit_button("âœ… à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥")

    # ===== à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸§à¸²à¸¡à¸„à¸£à¸šà¸–à¹‰à¸§à¸™ =====
    if submitted:
        if int(num_people) > 0 and len(companions) < int(num_people):
            st.error("âš ï¸ à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­-à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥ à¹à¸¥à¸°à¹€à¸¥à¸·à¸­à¸à¸à¸¥à¸¸à¹ˆà¸¡à¸‡à¸²à¸™à¸‚à¸­à¸‡à¸œà¸¹à¹‰à¸£à¹ˆà¸§à¸¡à¹€à¸”à¸´à¸™à¸—à¸²à¸‡à¹ƒà¸«à¹‰à¸„à¸£à¸šà¸à¹ˆà¸­à¸™à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥")
        elif not data["à¸Šà¸·à¹ˆà¸­-à¸ªà¸à¸¸à¸¥"]:
            st.error("âš ï¸ à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­-à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥à¸‚à¸­à¸‡à¸œà¸¹à¹‰à¹„à¸›à¸£à¸²à¸Šà¸à¸²à¸£")
        elif not data["à¸à¸´à¸ˆà¸à¸£à¸£à¸¡"]:
            st.error("âš ï¸ à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­à¸à¸´à¸ˆà¸à¸£à¸£à¸¡")
        else:
            df_scan = pd.concat([df_scan, pd.DataFrame([data])], ignore_index=True)
            df_scan.to_excel(FILE_SCAN, index=False)
            st.success("à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸²à¸£à¹„à¸›à¸£à¸²à¸Šà¸à¸²à¸£à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢ âœ…")

    # ===== Dashboard à¸à¸²à¸£à¹„à¸›à¸£à¸²à¸Šà¸à¸²à¸£ =====
    st.subheader("ðŸ“Š à¸ªà¸£à¸¸à¸›à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸²à¸£à¹„à¸›à¸£à¸²à¸Šà¸à¸²à¸£")

    if not df_scan.empty:
        st.write(f"ðŸ“‹ à¸ˆà¸³à¸™à¸§à¸™à¸£à¸²à¸¢à¸à¸²à¸£à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: {len(df_scan)} à¸£à¸²à¸¢à¸à¸²à¸£")
        if "à¸ˆà¸³à¸™à¸§à¸™à¸§à¸±à¸™" in df_scan.columns:
            st.write(f"ðŸ—“ï¸ à¸£à¸§à¸¡à¸ˆà¸³à¸™à¸§à¸™à¸§à¸±à¸™à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: {df_scan['à¸ˆà¸³à¸™à¸§à¸™à¸§à¸±à¸™'].sum()} à¸§à¸±à¸™")

        st.divider()

        # à¸à¸£à¸²à¸Ÿà¸£à¸²à¸¢à¹€à¸”à¸·à¸­à¸™
        if "à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸£à¸´à¹ˆà¸¡" in df_scan.columns:
            df_scan["à¹€à¸”à¸·à¸­à¸™"] = pd.to_datetime(df_scan["à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸£à¸´à¹ˆà¸¡"]).dt.month
            st.markdown("### ðŸ“† à¸ˆà¸³à¸™à¸§à¸™à¸à¸²à¸£à¹„à¸›à¸£à¸²à¸Šà¸à¸²à¸£à¸£à¸²à¸¢à¹€à¸”à¸·à¸­à¸™")
            st.bar_chart(df_scan["à¹€à¸”à¸·à¸­à¸™"].value_counts().sort_index())

        # à¸à¸£à¸²à¸Ÿà¸à¸´à¸ˆà¸à¸£à¸£à¸¡
        if "à¸à¸´à¸ˆà¸à¸£à¸£à¸¡" in df_scan.columns:
            st.markdown("### ðŸ¢ à¸›à¸£à¸°à¹€à¸ à¸—à¸à¸´à¸ˆà¸à¸£à¸£à¸¡")
            st.bar_chart(df_scan["à¸à¸´à¸ˆà¸à¸£à¸£à¸¡"].value_counts())

        # à¸à¸£à¸²à¸Ÿà¸à¸¥à¸¸à¹ˆà¸¡à¸‡à¸²à¸™
        if "à¸à¸¥à¸¸à¹ˆà¸¡à¸‡à¸²à¸™" in df_scan.columns:
            st.markdown("### ðŸ§© à¸à¸¥à¸¸à¹ˆà¸¡à¸‡à¸²à¸™à¸—à¸µà¹ˆà¹„à¸›à¸£à¸²à¸Šà¸à¸²à¸£à¸¡à¸²à¸à¸—à¸µà¹ˆà¸ªà¸¸à¸”")
            st.bar_chart(df_scan["à¸à¸¥à¸¸à¹ˆà¸¡à¸‡à¸²à¸™"].value_counts().sort_values(ascending=True))

        st.markdown("### ðŸ“‹ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”")
        st.dataframe(df_scan.astype(str), use_container_width=True)
    else:
        st.info("à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸²à¸£à¹„à¸›à¸£à¸²à¸Šà¸à¸²à¸£")

# ===== à¸Ÿà¸­à¸£à¹Œà¸¡à¸šà¸±à¸™à¸—à¸¶à¸à¸à¸²à¸£à¸¥à¸² =====
elif menu == "à¸à¸²à¸£à¸¥à¸²":
    with st.form("leave_form"):
        data = {}
        data["à¸Šà¸·à¹ˆà¸­-à¸ªà¸à¸¸à¸¥"] = st.text_input("ðŸ‘¤ à¸Šà¸·à¹ˆà¸­-à¸ªà¸à¸¸à¸¥")
        data["à¸à¸¥à¸¸à¹ˆà¸¡à¸‡à¸²à¸™"] = st.selectbox("ðŸ¢ à¸à¸¥à¸¸à¹ˆà¸¡à¸‡à¸²à¸™", staff_groups)
        data["à¸›à¸£à¸°à¹€à¸ à¸—à¸à¸²à¸£à¸¥à¸²"] = st.selectbox("ðŸ“Œ à¸›à¸£à¸°à¹€à¸ à¸—à¸à¸²à¸£à¸¥à¸²", ["à¸¥à¸²à¸›à¹ˆà¸§à¸¢", "à¸¥à¸²à¸à¸´à¸ˆ", "à¸¥à¸²à¸žà¸±à¸à¸œà¹ˆà¸­à¸™", "à¸¥à¸²à¸­à¸·à¹ˆà¸™à¹†"])
        data["à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸£à¸´à¹ˆà¸¡"] = st.date_input("ðŸ“… à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸£à¸´à¹ˆà¸¡à¸¥à¸²", dt.date.today())
        data["à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”"] = st.date_input("ðŸ“… à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”à¸à¸²à¸£à¸¥à¸²", dt.date.today())
        data["à¸ˆà¸³à¸™à¸§à¸™à¸§à¸±à¸™à¸¥à¸²"] = (data["à¸§à¸±à¸™à¸—à¸µà¹ˆà¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸”"] - data["à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸£à¸´à¹ˆà¸¡"]).days + 1
        data["à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸"] = st.text_area("ðŸ“ à¸«à¸¡à¸²à¸¢à¹€à¸«à¸•à¸¸")

        submitted = st.form_submit_button("âœ… à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥")

    if submitted:
        if not data["à¸Šà¸·à¹ˆà¸­-à¸ªà¸à¸¸à¸¥"]:
            st.error("âš ï¸ à¸à¸£à¸¸à¸“à¸²à¸à¸£à¸­à¸à¸Šà¸·à¹ˆà¸­-à¸™à¸²à¸¡à¸ªà¸à¸¸à¸¥à¸‚à¸­à¸‡à¸œà¸¹à¹‰à¸¥à¸²")
        else:
            df_report = pd.concat([df_report, pd.DataFrame([data])], ignore_index=True)
            df_report.to_excel(FILE_REPORT, index=False)
            st.success("à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸²à¸£à¸¥à¸²à¹€à¸£à¸µà¸¢à¸šà¸£à¹‰à¸­à¸¢ âœ…")

    # ===== Dashboard à¸à¸²à¸£à¸¥à¸² =====
    st.subheader("ðŸ“ˆ à¸ªà¸£à¸¸à¸›à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸²à¸£à¸¥à¸²")

    if not df_report.empty:
        st.write(f"ðŸ“‹ à¸ˆà¸³à¸™à¸§à¸™à¸£à¸²à¸¢à¸à¸²à¸£à¸à¸²à¸£à¸¥à¸²: {len(df_report)} à¸£à¸²à¸¢à¸à¸²à¸£")
        st.write(f"ðŸ—“ï¸ à¸£à¸§à¸¡à¸ˆà¸³à¸™à¸§à¸™à¸§à¸±à¸™à¸¥à¸²à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”: {df_report['à¸ˆà¸³à¸™à¸§à¸™à¸§à¸±à¸™à¸¥à¸²'].sum()} à¸§à¸±à¸™")

        st.divider()

        # à¸à¸£à¸²à¸Ÿà¸›à¸£à¸°à¹€à¸ à¸—à¸à¸²à¸£à¸¥à¸²
        if "à¸›à¸£à¸°à¹€à¸ à¸—à¸à¸²à¸£à¸¥à¸²" in df_report.columns:
            st.markdown("### ðŸ“Š à¸›à¸£à¸°à¹€à¸ à¸—à¸à¸²à¸£à¸¥à¸²")
            st.bar_chart(df_report["à¸›à¸£à¸°à¹€à¸ à¸—à¸à¸²à¸£à¸¥à¸²"].value_counts())

        # à¸à¸£à¸²à¸Ÿà¸£à¸²à¸¢à¹€à¸”à¸·à¸­à¸™
        if "à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸£à¸´à¹ˆà¸¡" in df_report.columns:
            df_report["à¹€à¸”à¸·à¸­à¸™"] = pd.to_datetime(df_report["à¸§à¸±à¸™à¸—à¸µà¹ˆà¹€à¸£à¸´à¹ˆà¸¡"]).dt.month
            st.markdown("### ðŸ“† à¸ˆà¸³à¸™à¸§à¸™à¸à¸²à¸£à¸¥à¸²à¸£à¸²à¸¢à¹€à¸”à¸·à¸­à¸™")
            st.bar_chart(df_report["à¹€à¸”à¸·à¸­à¸™"].value_counts().sort_index())

        # à¸à¸£à¸²à¸Ÿà¸à¸¥à¸¸à¹ˆà¸¡à¸‡à¸²à¸™
        if "à¸à¸¥à¸¸à¹ˆà¸¡à¸‡à¸²à¸™" in df_report.columns:
            st.markdown("### ðŸ§© à¸à¸¥à¸¸à¹ˆà¸¡à¸‡à¸²à¸™à¸—à¸µà¹ˆà¸¡à¸µà¸à¸²à¸£à¸¥à¸²à¸¡à¸²à¸à¸—à¸µà¹ˆà¸ªà¸¸à¸”")
            st.bar_chart(df_report["à¸à¸¥à¸¸à¹ˆà¸¡à¸‡à¸²à¸™"].value_counts().sort_values(ascending=True))

        st.markdown("### ðŸ“‹ à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”")
        st.dataframe(df_report.astype(str), use_container_width=True)
    else:
        st.info("à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸à¸²à¸£à¸¥à¸²à¹ƒà¸™à¸£à¸°à¸šà¸š")
